<template id="listItem">
    <li class="list-item">
        <div id="text"></div>
        <input id="switch" type="checkbox">
    </li>
</template>

<script>
    class TodoItem extends HTMLElement {

        get todo(){
            return this._todo;
        }

        set todo(newValue){
            this._todo = newValue;
        }

        set selected(newValue){
            this.setAttribute('selected', newValue);
        }

        connectedCallback() {
            const currentDocument = document.currentScript.ownerDocument;
            this.listItemTemplate = currentDocument.querySelector('#listItem');
            this.listItem = listItemTemplate.content.cloneNode(true);
            this.todoContent = listItemTemplate.querySelector('#text');
            this.switch = listItemTemplate.querySelector('#switch');
            addEventListeners();

            this.appendBody(this.listItem);
        }

        disconnectionedCallback() {
            removeEventListeners();
            this.listItemTemplate = null;
            this.listItem = null;
            this.todoContent = null;
            this.switch = null;
        }

        addEventListeners() {
            
            this.itemSelectedEventHandler = itemSelected.bind(this);
            this.statusChangedEventHandler = statusChanged.bind(this);
            this.todoContent.addEventListener('click', itemSelectedEventHandler, false);
            this.switch.addEventListener('click', statusChangedEventHandler, false);
        }

        removeEventListeners() {
            this.todoContent.removeEventListener('click', this.itemSelectedEventHandler, false);
            this.switch.removeEventListener('click', statusChangedEventHandler, false);

            this.itemSelectedEventHandler = null;
            this.statusChangedEventHandler = null;
        }

        itemSelected(){
            todo.selected = !todo.selected;
        }

        statusChanged(){
            todo.setStatus(this.switch.checked);
        }
    }

    customElements.define("li-todo", TodoItem);
</script>