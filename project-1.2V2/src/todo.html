<template id="listItem">
    <li class="list-item">
        <div id="text"></div>
        <input id="switch" type="checkbox">
    </li>
</template>

<script>
    class TodoItem extends HTMLElement {
        
        get todo(){
            return this.getAttribute('todo') || this._todo;
        }

        set todo(value){
            this._todo = value;
            this.update();
        }

        update(){
            if(this.todo == undefined){
                this.textContent.data.content = null;
                this.switch.check = null;
                return;
            }
            this.todoContent.dataset.content = this.todo.getDescription();
            this.switch.check = this.todo.getStatus();
        }

        connectedCallback() {
            this.initializeTemplate();
        }

        initializeTemplate(){
            const currentDocument = document.currentScript.ownerDocument;
            this.listItemTemplate = currentDocument.querySelector('#listItem');
            this.listItem = currentDocument.importNode(this.listItemTemplate.content, true);
            this.todoContent = this.listItem.querySelector('#text');
            this.switch = this.listItem.querySelector('#switch');
            this.appendChild(this.listItem);
            this.addEventListeners();
        }

        disconnectionedCallback() {
            removeEventListeners();
            this.listItemTemplate = null;
            this.listItem = null;
            this.todoContent = null;
            this.switch = null;
        }

        addEventListeners() {
            
            this.itemSelectedEventHandler = this.itemSelected.bind(this);
            this.statusChangedEventHandler = this.statusChanged.bind(this);
            this.todoContent.addEventListener('click', this.itemSelectedEventHandler, false);
            this.switch.addEventListener('click', this.statusChangedEventHandler, false);
        }

        removeEventListeners() {
            this.todoContent.removeEventListener('click', this.itemSelectedEventHandler, false);
            this.switch.removeEventListener('click', this.statusChangedEventHandler, false);

            this.itemSelectedEventHandler = null;
            this.statusChangedEventHandler = null;
        }

        itemSelected(){
            console.log('item selected');
            
        }

        statusChanged(){
            console.log('status changed');
            this._todo.setStatus(this.switch.check);
        }
    }

    customElements.define("li-todo", TodoItem);
</script>